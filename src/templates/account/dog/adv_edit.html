{% extends "layout_popup.html" %}



	{#<p>Ваше объявление увидит более <b>1&nbsp;000</b> человек в неделю.</p>#}
	
		
{% block page_desc %}

<hr/>

<p>
	<span class="glyphicon glyphicon-asterisk small" style="color:red"></span> &mdash; поля обязательны для заполнения.
</p>

{%endblock%}	


{% block content %}



<div class="sale-edit">
    <div class="">

        {% from "forms.html" import form_field_boolean, form_field, action_buttons %}

        <form class="form-sale-adv" class="" id="adv" method="post" action="{{request.url}}" enctype="multipart/form-data" >

        	<div class="row">
        		
        		<div class="col-md-10">
        	

		        	{{ main_info(form) }}
					  
					{{ advanced_info(form) }}
		      			
		         	{{ contact_info(form) }}


			        <div class="actions text-left" style="margin-top:40px">
			          <button type="submit" class="btn btn-primary btn-lg" id="update" data-loading-text="Сохраняется...">Сохранить</button>
			          &nbsp;
			          {#<a class="btn" href="{{url_for('account_sale')}}" id="cancel">Отменить</a>#}
			        </div>

	        </div>

	        </div>

			{{ js(form) }}
      </form>
        
  </div>
</div>
{% endblock%}



{%- macro main_info(form, horizontal) -%}
	{% from "forms.html" import form_field_boolean, form_field, action_buttons %}

	
		{#<h2 class="text-right">Основная информация</h2>
		#}
			

		{{ form_field(form.breed, horizontal={"l": "col-sm-3", "r":"col-sm-9"} , size="col-sm-8", placeholder=(dogs | random), help = "Выберите породу из выпадающего списка, вводя любую часть названия,  например, шпиц.", autocomplete="off") }}   
		
    
        {{ form_field(form.city, horizontal={"l": "col-sm-3", "r":"col-sm-9"}, size="col-sm-8", placeholder=(large_cities | random).get("city_id") | city_region, help="Выберите из выпадающего списка населенный пункт, вводя первые буквы.", autocomplete="off") }}
    
	    {{ form_field(form.title, horizontal={"l": "col-sm-3", "r":"col-sm-9"}, placeholder="", help = "Напишите наиболее привлекательный заголовок.")}}

		{{ form_field(form.price, horizontal={"l": "col-sm-3", "r":"col-sm-9"}, placeholder="35000", addon_right = "руб", size="col-lg-3 col-md-3 col-sm-4") }}   		
	    	
	    	<div class="row" style="margin-top:-15px">
	    		
				<div class="col-sm-9 col-sm-push-3">
					{{ form_field(form.price_haggle) }}
					{{ form_field(form.price_hp) }}	
					{{form_field(form.contract)}}
  					{{form_field(form.delivery)}}	
				</div>
	    	</div>	
		
	    
      	

{%- endmacro -%}


{%- macro advanced_info(form) -%}
	{% from "forms.html" import form_field_boolean, form_field, action_buttons %}
					

      			<div style="display:none">
	                {{ form_field(form.photos) }}
	             </div>

	             	<div class="row" style="margin-bottom:10px;">
	             		<div class="col-sm-3">
	             			<label for="uploader" class="form-field-name" style="margin-bottom:-10px">Фотографии</label>
	             		</div>
	             		<div class="col-sm-9">
	             			<!--span style="color:red" class="small glyphicon glyphicon-asterisk"></span-->
			               
			                  {#<p class="text-left main-photo text-alert" title=""><small>Главная фотография</small> </p>#}

			                  {% include "uploader.html" %}
	             		</div>

	             	</div>

	             	{{ form_field(form.birthday, horizontal={"l":"col-sm-3", "r":"col-sm-9"}, help="", help_placement="top", style="width:120px") }}
	  			
  					{{ form_field(form.gender, horizontal = {"l":"col-sm-3", "r":"col-sm-9"}, style="width:120px") }}

  					
					{{ form_field(form.color, horizontal={"l":"col-sm-3", "r":"col-sm-9"}, size="col-sm-6", help="Официальное название окраса можно посмотреть в метрике или родословной, например, рыжий.") }}
				
	  				
  					
	  				

	  			<div class="row" style="margin-bottom:10px; margin-top:-10px">
	  				<div class="col-sm-3">
	  					<label for="r" class="form-field-name" style="margin-bottom:-10px">Разное</label>
	  				</div>
	  				<div class="col-sm-9">
  						{{form_field(form.microchip)}}	
	  					{{form_field(form.vaccination)}}	
	  					{{form_field(form.vetpassport)}}
	  				</div>
	  			</div>
	  				
			  	{{doc(form)}}

	              {{ form_field(form.desc, rows="8", help = "Опишите вашу собаку с выгодной стороны. Характер, психика, поведение, привычки, генетическая предрасположенность и тп", horizontal = {"l":"col-sm-3", "r":"col-sm-9"}) }}    
	          

{%- endmacro -%}




{%- macro doc(form) -%}
	{% from "forms.html" import form_field_boolean, form_field, action_buttons %}

	
		{{form_field(form.doc, horizontal ={"l":"col-sm-3", "r":"col-sm-9"}, size="col-md-6 col-lg-5")}}

<div id="doc_fields" class="bg-info" style="padding:10px 20px 20px 20px; margin-bottom:20px; {{'display:none' if not form.doc.data else ''}}">

		<h3 id="doc_name">{{form.doc.data | doc_dog_name }}</h3>

		
			
			<div class="row" style="margin-top:20px; ">
				<div class="col-sm-3" id="{{form.pedigree.id}}_block" style="{{'display:none' if form.doc.data not in dog_pedigree_docs else ''}}">
					{{ form_field(form.pedigree, style="width:150px")}}
				</div>
				<div class="col-sm-3">
					
					{{ form_field(form.tatoo, help_placement="top", style="width:150px") }}
				</div>	
				<div style="margin-top:10px" class="col-sm-6">
					{{ form_field(form.breeding) }} 
					{{ form_field(form.show) }}
					</div>			
			</div> 
			
			
		

		
			<h4>Отец</h4>
			<div class="row">
					<div class="col-sm-5">
						{{form_field(form.father_name, class="form-control")}}		
					</div>
					<div class="col-sm-4">
						{{form_field(form.father_country, class="form-control")}}
					</div>
					<div class="col-sm-3">
						{{form_field(form.father_pedigree, class="form-control")}}	
					</div>
				</div>

				{{form_field(form.father_misc, class="form-control", rows = 2)}}
		

	


				
	
				<h4>Мать</h4>
			
		   			<div class="row">
						<div class="col-sm-5">
							{{form_field(form.mother_name, class="form-control")}}			
						</div>
						<div class="col-sm-4">
							{{form_field(form.mother_country, class="form-control")}}
						</div>
						<div class="col-sm-3">
							{{form_field(form.mother_pedigree, class="form-control")}}	
						</div>
					</div>
				
				{{form_field(form.mother_misc, class="form-control", rows = 2)}}
		
	

</div> <!-- doc-fields -->
				
{%- endmacro-%}



{%- macro contact_info(form) -%}
{% from "forms.html" import form_field_boolean, form_field, action_buttons %}
	
  	<h2 class="text-left page-header">Контактная информация</h2>

  	{{ form_field(form.username, size="col-sm-5", placeholder = "Укажите контактное лицо", horizontal = {"l":"col-sm-3", "r":"col-sm-9"}) }}

	{{ form_field(form.phone, size="col-lg-3 col-md-4 col-sm-5", placeholder = "Введите тел. номер", horizontal = {"l":"col-sm-3", "r":"col-sm-9"}) }}

	{{ form_field(form.skype, size="col-lg-3 col-md-4 col-sm-5", placeholder="Введите skype-имя", horizontal = {"l":"col-sm-3", "r":"col-sm-9"}) }}


{%- endmacro -%}


{%- macro js(form) -%}
{% from "forms.html" import form_field_boolean, form_field, action_buttons %}
<script type="text/javascript">
            
//location with autocomplete built on typeahead.js
$(document).ready(function(){

	$("#{{form.doc.id}}").change(function(){

		if($.inArray(this.value, ["1", "3", "5"]) >= 0) {
			$("#{{form.pedigree.id}}_block").show();
		
		} else {
			$("#{{form.pedigree.id}}_block").hide();
		}

		if(this.value > 0) {
			$("#doc_fields").show("fast");
			$("#doc_name").text($("#{{form.doc.id}} option:selected").html());

		} else {
			$("#doc_fields").hide("fast");
			$("#doc_name").text();
		}
		
	});

  $("#{{form.city.id}}").typeahead(
	  povodochek.typeahead(
	  "{{url_for('ajax_typeahead_location')}}",
	  "{{form.city.id}}")); //typeahead  


   $("#{{form.breed.id}}").typeahead(
	  povodochek.typeahead(
	  "{{url_for('ajax_typeahead_dog')}}",
	  "{{form.breed.id}}")); //typeahead 


  
//validation

  var submit = function(){photos = $("#photos").val("");
      $.each(uploader.getFileNames(), function(i, filename) {
        if(filename && photos.val()) {
          photos.val(photos.val() + "," + filename);
        } else {
          photos.val(filename);
        }
      });
    };

   
    $("#{{form.phone.id}}").inputmask({"mask": "+7(999)999-9999", 
    });

    $("#{{form.birthday.id}}").inputmask("d/m/y"); 

    $("#{{form.price.id}}").inputmask("integer", { allowMinus: false, allowPlus: false, rightAlignNumerics: false});
  

  povodochek.validate($("form"), {
      breed: { required: true },
      title: { required: true, rangelength: [10, 80] },
      desc : { required: true, maxlength: 500 },
      price : { required: true, range: [5000, 300000] },
      // age : {required: true},
      // gender : {required: true},
      city : {required: true}, 
      phone : {_phone: true}, 
      username : {required : true}
   }, submit);


  $('#desc').textareaCount({
    'originalStyle': 'textarea-counter', 
    'displayFormat' : "#input"});


  $("[data-toggle='tooltip']").tooltip();
  
});

</script>

{%- endmacro -%}

